{% extends "main/base.html" %}
{% block title %}Teachers{% endblock %}
{% block content %}

{% if request.user.is_authenticated %}
<h1>
  {% if filter is None %}
  <center>Teachers</center>
  {% else %}
  <center>{{filter|capfirst}} Teachers</center>
  {% endif %}
</h1>

<br>
<div class="container text-center">
  <div class="row g-2 justify-content-center">
    <div class="col-4 m-2 shadow-sm p-3 mb-5 bg-body-tertiary rounded bg-light">
      <h3>Faculty Count: {{teachers.count}}</h3>
    </div>
    <div class="col-4 m-2 shadow-sm p-3 mb-5 bg-body-tertiary rounded bg-light align-items-center justify-content-center">
      <h3>Average Salary: ${{avgSalary}}</h3>
      <br />
      <h3>Average Salary: {{avgSkill}}</h3>
      </a>
    </div>
  </div>
</div>
<br />

<form action="" id="filter">
  <select name="filter">
    <option value="all">All</option>
    {% for subject in subjects %}
    <option value="{{subject}}">{{subject}}</option>
    {% endfor %}
  </select>
</form>
<br>

<div id="teacher-container" class="container overflow-hidden text-center">
  <div class="row row-cols-2 row-cols-lg-5 g-2 g-lg-3">
    {% for teacher in teachers %}
    <div class="col-2">
      <div id="{{teacher.id}}" class="card mb-3" style="max-width: 18rem;">
        <div class="card-header bg-primary">
          <h5><a class="title-header link-dark bg-primary fw-medium" href="{% url 'main:teacher' teacher.id %}">{{teacher|title}} <i class="bi bi-arrow-up-right-circle"></i></a></h5>
        </div>
        <div class="card-body">
          <h5 class="card-title">
            <span style="width: 100%;" class="m-1 badge bg-dark">Specialization: <span class="badge bg-secondary"> {{ teacher.subject }}</span></span>
              <br />
              <span style="width: 100%;" class="m-1 badge bg-dark">Skill: <span class="badge bg-secondary"> {{ teacher.skill }}</span></span>
              <br />
              <span style="width: 100%;" class="m-1 badge bg-dark">Salary: <span class="badge bg-secondary"> {{ teacher.salary }}</span></span>
          </h5>
          <br>
          <a href="{% url 'main:delete' teacher.id 'teacher' %}">
            <button type="button" class="btn btn-outline-danger">Delete Teacher</button>
          </a>
        </div>
      </div>
    </div>
    {% endfor %}
    <div id="start_create_teacher" class="col-2">
      <div class="card mb-3" style="max-width: 18rem">
        <div class="card-header bg-primary">
          <h5 class="text-dark bg-primary fw-medium">New Teacher?</h5>
        </div>
        <div class="card-body">
          <button class="toggler btn btn-outline-primary" id="teacher">Create</button>
        </div>
      </div>
    </div>
    <div id="create_teacher" class="col-2" style="display: none;">
      <div class="card mb-3" style="max-width: 18rem">
        <div class="card-header bg-primary">
          <h5 class="text-dark bg-primary fw-medium">Create Teacher</h5>
        </div>
        <div class="card-body">
          <div class="card-title">
            <form method="POST" action="{% url 'main:create_teacher' None %}">
              {% csrf_token %} {% if filter is None %}
              <input pattern=".{1,}" required type="text" name="major" placeholder="Major" list="majorList" />
              {% else %}
              <input pattern=".{1,}" required type="text" value="{{filter}}" name="major" placeholder="Major"
                list="majorList" />
              {% endif %}
              <datalist id="majorList">
                <select id="majors">
                  {% for subject in subjects %}
                  <option value="{{subject}}">{{subject}}</option>
                  {% endfor %}
                </select>
              </datalist>
              <br />
              {{form}}
              <br />
              <br />
              <button class="btn btn-outline-success" type="submit">Submit</button>
              <button class="toggler btn btn-outline-danger" id="teacher">Cancel</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% endif %}

<script>
  function toggleEditSection(id) {
    let category;
    if ((category = document.getElementById(id)) != null) {
      if (category.style.display == "none") {
        category.style.display = "block";
        document.querySelector("#start_" + id).style.display = "none";
      } else {
        category.style.display = "none";
        document.querySelector("#start_" + id).style.display = "block";
      }
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll(".toggler").forEach((el) => {
      el.onclick = (el) => {
        toggleEditSection("create_" + el.target.id);
      };
    });

    document.querySelector("#filter").onchange = (el) => {
      document.querySelector("#filter").submit();
    };
  });
</script>

{% endblock %}